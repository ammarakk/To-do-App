openapi: 3.0.3
info:
  title: Todo API
  description: |
    Multi-user Todo application API with secure authentication and user data isolation.

    **Authentication**: All endpoints (except auth endpoints) require a valid JWT token in the `Authorization` header.

    **User Isolation**: All todo operations are scoped to the authenticated user. Users cannot access other users' data.

    **Pagination**: List endpoints support pagination via `page` and `limit` query parameters.

    **Error Handling**: All errors follow a consistent JSON format.

  version: 1.0.0
  contact:
    name: Evolution of Todo Project
  license:
    name: MIT

servers:
  - url: http://localhost:8000
    description: Local development server
  - url: https://api.todo-app.example.com
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Auth
    description: Authentication and user management
  - name: Todos
    description: Todo CRUD operations

paths:
  /:
    get:
      tags: [Health]
      summary: Health check
      description: Check if the API is running
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  version:
                    type: string
                    example: 1.0.0

  /api/auth/signup:
    post:
      tags: [Auth]
      summary: Sign up a new user
      description: Create a new user account with email and password
      operationId: signUp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignUpRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SignUpResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: User already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/auth/login:
    post:
      tags: [Auth]
      summary: Log in
      description: Authenticate with email and password
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /api/auth/logout:
    post:
      tags: [Auth]
      summary: Log out
      description: Invalidate the current session
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LogoutResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/todos:
    get:
      tags: [Todos]
      summary: List todos
      description: Get a paginated list of todos for the authenticated user, with optional search and filters
      operationId: listTodos
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          description: Search in title and description
          schema:
            type: string
          example: groceries
        - name: priority
          in: query
          description: Filter by priority
          schema:
            type: string
            enum: [low, medium, high]
          example: high
        - name: is_completed
          in: query
          description: Filter by completion status
          schema:
            type: boolean
          example: false
        - name: category
          in: query
          description: Filter by category
          schema:
            type: string
          example: work
        - name: page
          in: query
          description: Page number (starts from 1)
          schema:
            type: integer
            minimum: 1
            default: 1
          example: 1
        - name: limit
          in: query
          description: Items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          example: 20
      responses:
        '200':
          description: List of todos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/InternalServerError'

    post:
      tags: [Todos]
      summary: Create a todo
      description: Create a new todo for the authenticated user
      operationId: createTodo
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoCreateRequest'
      responses:
        '201':
          description: Todo created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'

  /api/todos/{todo_id}:
    get:
      tags: [Todos]
      summary: Get a todo
      description: Get a specific todo by ID
      operationId: getTodo
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/TodoId'
      responses:
        '200':
          description: Todo details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

    put:
      tags: [Todos]
      summary: Update a todo
      description: Update a specific todo by ID
      operationId: updateTodo
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/TodoId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TodoUpdateRequest'
      responses:
        '200':
          description: Todo updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TodoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '422':
          $ref: '#/components/responses/ValidationError'

    delete:
      tags: [Todos]
      summary: Delete a todo
      description: Delete a specific todo by ID
      operationId: deleteTodo
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/TodoId'
      responses:
        '200':
          description: Todo deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token from Supabase Auth (use the access_token)

  parameters:
    TodoId:
      name: todo_id
      in: path
      required: true
      description: Todo UUID
      schema:
        type: string
        format: uuid
      example: 550e8400-e29b-41d4-a716-446655440000

  schemas:
    SignUpRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          minLength: 8
          example: securePassword123

    SignUpResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: JWT refresh token
        expires_in:
          type: integer
          description: Token expiry time in seconds
          example: 3600

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        password:
          type: string
          format: password
          example: securePassword123

    LoginResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        access_token:
          type: string
          description: JWT access token
        refresh_token:
          type: string
          description: JWT refresh token
        expires_in:
          type: integer
          description: Token expiry time in seconds
          example: 3600

    LogoutResponse:
      type: object
      properties:
        message:
          type: string
          example: Logged out successfully

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: User's unique identifier
        email:
          type: string
          format: email
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    TodoCreateRequest:
      type: object
      required:
        - title
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          description: Todo title
          example: Buy groceries
        description:
          type: string
          maxLength: 2000
          description: Detailed description
          example: Get milk, eggs, and bread
        priority:
          type: string
          enum: [low, medium, high]
          default: medium
          description: Priority level
          example: high
        due_date:
          type: string
          format: date-time
          description: Due date with timezone
          example: '2026-01-20T18:00:00Z'
        category:
          type: string
          maxLength: 50
          description: Category/tag
          example: personal

    TodoUpdateRequest:
      type: object
      properties:
        title:
          type: string
          minLength: 1
          maxLength: 200
          example: Buy groceries and cook dinner
        description:
          type: string
          maxLength: 2000
          example: Get milk, eggs, bread, and pasta
        is_completed:
          type: boolean
          example: true
        priority:
          type: string
          enum: [low, medium, high]
          example: low
        due_date:
          type: string
          format: date-time
          example: '2026-01-21T18:00:00Z'
        category:
          type: string
          maxLength: 50
          example: shopping

    TodoResponse:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: Todo unique identifier
        user_id:
          type: string
          format: uuid
          description: Owner's user ID
        title:
          type: string
          description: Todo title
        description:
          type: string
          nullable: true
          description: Todo description
        is_completed:
          type: boolean
          description: Completion status
        priority:
          type: string
          enum: [low, medium, high]
          description: Priority level
        due_date:
          type: string
          format: date-time
          nullable: true
          description: Due date
        category:
          type: string
          nullable: true
          description: Category/tag
        created_at:
          type: string
          format: date-time
          description: Creation timestamp
        updated_at:
          type: string
          format: date-time
          description: Last update timestamp

    TodoListResponse:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/TodoResponse'
        total:
          type: integer
          description: Total number of todos matching filters
          example: 42
        page:
          type: integer
          description: Current page number
          example: 1
        limit:
          type: integer
          description: Items per page
          example: 20
        pages:
          type: integer
          description: Total number of pages
          example: 3

    DeleteResponse:
      type: object
      properties:
        message:
          type: string
          example: Todo deleted successfully

    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: string
              example: VALIDATION_ERROR
            message:
              type: string
              example: Request validation failed
            details:
              type: array
              items:
                type: string
              example: ["email is required", "password must be at least 8 characters"]

  responses:
    BadRequest:
      description: Bad request - Invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: BAD_REQUEST
              message: Invalid request data
              details: ["email field is required"]

    Unauthorized:
      description: Unauthorized - Missing or invalid JWT token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: UNAUTHORIZED
              message: Authentication required
              details: []

    Forbidden:
      description: Forbidden - Access denied to this resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: FORBIDDEN
              message: You do not have permission to access this resource
              details: []

    NotFound:
      description: Not found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: NOT_FOUND
              message: Todo not found
              details: []

    ValidationError:
      description: Validation error - Request data is invalid
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: VALIDATION_ERROR
              message: Request validation failed
              details: ["title must be between 1 and 200 characters"]

    InternalServerError:
      description: Internal server error - Something went wrong
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
          example:
            error:
              code: INTERNAL_SERVER_ERROR
              message: An unexpected error occurred
              details: []
