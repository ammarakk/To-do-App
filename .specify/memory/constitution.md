<!--
  SYNC IMPACT REPORT
  ===================
  Version Change: INITIAL → 1.0.0
  Rationale: Initial constitution ratification with core principles and governance

  Modified Principles: N/A (initial version)

  Added Sections:
  - All principles and sections are new

  Removed Sections: N/A

  Templates Requiring Updates:
  ✅ plan-template.md - Reviewed, Constitution Check section aligns
  ✅ spec-template.md - Reviewed, scope/requirements align
  ✅ tasks-template.md - Implicit alignment through spec-driven workflow
  ⚠ agent-file-template.md - May need review for agent-specific prompts
  ⚠ command files - Should be reviewed for FastAPI/Supabase references

  Follow-up TODOs:
  - Review agent-file-template.md for agent role definitions
  - Review command files (.specify/templates/commands/*.md) for technology stack references
  - Create quickstart guide documenting FastAPI + Supabase setup
-->

# Evolution of Todo Constitution

## Core Mission & Development Philosophy

### I. Prompt-Only Development

**Principle**: The engineer acts as a "System Architect". **No code is to be written manually**. All implementation is driven through **System Prompts** and **Agent Prompts** that must be refined until the AI generates the correct output.

**Rationale**: This ensures consistency, reduces human error, and maintains a strict spec-driven workflow where all code artifacts are traceable to validated prompts and specifications.

**Requirements**:
- All code changes MUST be generated by AI agents following validated prompts
- Manual code editing is PROHIBITED except for prompt refinement
- Prompts MUST be refined iteratively until correct output is achieved
- All prompts MUST be documented and version-controlled

### II. Spec-Driven Development (SDD)

**Principle**: All development follows the strict lifecycle: **Specify → Plan → Tasks → Implement**.

**Rationale**: This ensures every feature is properly specified, architected, broken down into testable tasks, and implemented with traceability.

**Requirements**:
- NO implementation without a completed specification
- NO implementation without an approved architectural plan
- NO implementation without validated, testable tasks
- Each phase MUST produce artifacts before proceeding to next
- Hierarchy of Truth: Constitution > Spec > Plan > Tasks

### III. Mandatory Technology Stack

**Principle**: All implementations MUST use the designated technology stack without deviation.

**Rationale**: Standardization ensures maintainability, reduces cognitive load, and enables clear architectural patterns across all phases.

**Backend Stack**:
- **Language**: Python 3.13+
- **Framework**: **FastAPI** (RESTful API endpoints)
- **Testing**: pytest with FastAPI TestClient

**Frontend Stack**:
- **Framework**: Next.js 16+ (App Router only)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Testing**: Jest + React Testing Library

**Database & Auth**:
- **Database**: **Neon PostgreSQL** or **Supabase** (PostgreSQL) - Choice per project phase
- **Auth**: **Custom JWT-based authentication** or **Supabase Auth** - Choice per project phase
- **ORM**: SQLAlchemy (async) with asyncpg for Neon, or Supabase Python Client for Supabase

**AI Agentic Stack**:
- **Primary Agent**: Claude Code
- **Framework**: Spec-Kit Plus
- **SDKs**: OpenAI Agents SDK, Official MCP SDK

**Cloud Native Stack** (Phase IV+):
- **Containers**: Docker
- **Orchestration**: Kubernetes (Minikube)
- **Package Management**: Helm Charts
- **Messaging**: Kafka
- **Runtime**: Dapr

**Prohibited Technologies**:
- Express.js, Flask, Django (use FastAPI ONLY)
- Pages Router (use App Router ONLY)
- Any unauthorized MCP tools beyond Official MCP SDK

### IV. Project Phases (The Evolution of Todo)

**Principle**: The project evolves through clearly defined phases, each building upon the previous. Phases are locked once completed.

**Rationale**: Incremental evolution ensures stability, validates architectural decisions, and provides clear deliverables.

**Phase I: In-Memory Python Console App** (COMPLETED & LOCKED)
- CLI-based CRUD operations (Add, Delete, Update, View, Mark Complete)
- In-memory storage
- Python 3.13+ with `uv` package manager
- Agent-orchestrated implementation

**Phase II: Full-Stack Web Application** (IN PROGRESS)
- Transition to multi-user web application
- Backend: FastAPI with RESTful endpoints
- Frontend: Next.js 16+ with TypeScript and Tailwind
- Database: Supabase PostgreSQL (replacing in-memory storage)
- Auth: Supabase Auth for user isolation and data security
- Deploy: Vercel (frontend) + appropriate backend hosting

**Phase II-N: Neon PostgreSQL + BetterAuth Migration** (OPTIONAL)
- Complete Supabase removal
- Backend: FastAPI with async SQLAlchemy and Neon PostgreSQL
- Auth: Custom JWT-based authentication (BetterAuth patterns)
- Modern UI: Neon-inspired SaaS-grade design
- Deploy: Vercel (frontend) + Railway/Render (backend)

**Phase III: AI-Powered Todo Chatbot** (PLANNED)
- Conversational interface using OpenAI Agents SDK
- Stateless tools built with Official MCP SDK
- Natural language task management
- Integration with FastAPI backend and Supabase

**Phase IV: Local Kubernetes Deployment** (PLANNED)
- Containerize FastAPI and Next.js services
- Deploy to Minikube using Helm Charts
- AIOps integration with kubectl-ai
- Service mesh and observability

**Phase V: Advanced Cloud Deployment** (PLANNED)
- Event-driven architecture with Kafka
- Dapr for recurring tasks and reminders
- Distributed tracing and monitoring
- Horizontal scaling strategies

**Phase Locking Rules**:
- Once a phase is marked **COMPLETED & LOCKED**, it MUST NOT be modified
- Phase transitions MUST be approved by human architect
- Each phase MUST remain functional (no breaking changes to previous phases)

### V. Architecture of Intelligence (Prompts & Skills)

**Principle**: All intelligence is encapsulated in reusable prompts and agent skills. No improvisation or "vibe coding" permitted.

**Rationale**: Reusable intelligence ensures consistency, reduces duplication, and enables predictable AI behavior across all phases.

**Agent Roles**:
- **The Executor (Claude Code)**: Follows System Prompts to perform code changes based on validated Task IDs
- **Subagents**: Specialized AI instances spawned for domain-specific tasks (e.g., Supabase schema generation, FastAPI route creation)

**Reusable Skills**:
- **MCP Builder Skill**: Generate stateless MCP tools following Official MCP SDK patterns
- **Cloud-Native Blueprints**: Reusable deployment patterns for Docker, Kubernetes, Helm
- **Validation Skills**: Input validation, auth checks, user isolation enforcement
- **Testing Skills**: Automated test generation for FastAPI and Next.js

**Stateless Logic Requirement**:
- All backend logic MUST be stateless
- All persistence handled by Supabase database
- All MCP tools MUST be stateless (no in-memory session storage)
- Auth state managed by Supabase Auth, not custom implementations

### VI. Operational Constraints

**Principle**: Strict adherence to development constraints ensures quality and maintainability.

**Rationale**: Constraints prevent technical debt, ensure security, and maintain architectural integrity.

**No "Vibe Coding"**:
- Agents MUST NOT improvise or assume requirements
- If a prompt or spec is incomplete, the agent MUST stop and request clarification
- All implementations MUST be traceable to specific Task IDs from tasks.md

**Task Identification**:
- Every implementation MUST be tied to a specific Task ID
- Tasks MUST be defined in tasks.md before implementation begins
- Task completion MUST be verified with tests before marking done

**Security Requirements**:
- All FastAPI routes MUST enforce user isolation
- Users MUST only access their own data via authenticated Supabase sessions
- No hardcoded credentials or secrets (use environment variables)
- All API endpoints MUST validate Supabase JWT tokens
- Row-Level Security (RLS) MUST be enabled in Supabase

**Code Quality**:
- All code MUST be type-hinted (Python type hints, TypeScript types)
- All functions MUST have docstrings following PEP 257 (Python) or JSDoc (TypeScript)
- All tests MUST pass before phase completion
- Maximum test coverage threshold: 80% (enforced via CI/CD)

## Project Structure

```
/
├── .specify/
│   ├── memory/
│   │   └── constitution.md          # This file
│   ├── templates/                   # All SDD templates
│   └── scripts/                     # Automation scripts
├── src/                             # Phase 1 (Console App)
├── backend/                         # Phase 2 (FastAPI)
├── frontend/                        # Phase 2 (Next.js)
├── specs/                           # All feature specifications
├── history/
│   ├── prompts/                     # Prompt History Records (PHRs)
│   └── adr/                         # Architecture Decision Records
└── docs/                            # Additional documentation
```

## Technology Stack Summary

| Layer | Technology | Version |
|-------|-----------|---------|
| **Backend Language** | Python | 3.13+ |
| **Backend Framework** | FastAPI | Latest |
| **Frontend Framework** | Next.js | 16+ (App Router) |
| **Frontend Language** | TypeScript | 5+ |
| **Styling** | Tailwind CSS | 3+ |
| **Database** | Supabase (PostgreSQL) | Latest |
| **Auth** | Supabase Auth | Latest |
| **AI Framework** | OpenAI Agents SDK | Latest |
| **MCP SDK** | Official MCP SDK | Latest |
| **Container** | Docker | Latest |
| **Orchestration** | Kubernetes (Minikube) | Latest |
| **Package Manager** | Helm | Latest |
| **Messaging** | Kafka | Latest |
| **Runtime** | Dapr | Latest |

## Governance

### Amendment Procedure
1. Proposed amendments MUST be documented with rationale
2. Amendments MUST NOT break completed/locked phases
3. Amendments MUST be approved by human architect
4. Version MUST be incremented according to semantic versioning
5. All dependent artifacts MUST be updated for consistency

### Versioning Policy
- **MAJOR**: Backward incompatible governance/principle removals or redefinitions
- **MINOR**: New principle/section added or materially expanded guidance
- **PATCH**: Clarifications, wording fixes, non-semantic refinements

### Compliance Review
- All code reviews MUST verify constitution compliance
- All phase transitions MUST pass compliance gate
- All technology choices MUST be validated against Mandatory Technology Stack
- Non-compliance MUST block deployment until resolved

### Hierarchy of Authority
1. **Constitution** (this file) - Supreme authority
2. **Specifications** (specs/*/*/spec.md) - Feature requirements
3. **Plans** (specs/*/*/plan.md) - Architecture decisions
4. **Tasks** (specs/*/*/tasks.md) - Implementation tasks

### Amendment Log

| Version | Date | Changes | Author |
|---------|------|---------|--------|
| 1.0.0 | 2026-01-16 | Initial ratification with FastAPI, Supabase, and prompts-driven principles | System Architect |
| 1.1.0 | 2026-01-18 | Phase II-N Technology Update: Permit Neon PostgreSQL and custom JWT auth as alternatives to Supabase. Add Phase II-N as optional migration path. Maintain backward compatibility with Phase II (Supabase). | System Architect |

---

**Version**: 1.1.0 | **Ratified**: 2026-01-16 | **Last Amended**: 2026-01-18
